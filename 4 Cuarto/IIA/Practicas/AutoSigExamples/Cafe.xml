<process>
    <name>Cafe</name>
    <config>
        <debug>true</debug>
        <async>true</async>
    </config>
    <tasks>
        <task>
            <name>Divisor</name>
            <type>splitter</type>
            <config>/cafe_order/drinks/drink</config>
            <outputs>
                <output>Encauzador</output>
            </outputs>
        </task>
        <task>
            <name>Encauzador</name>
            <type>distributor</type>
            <config>
                <case>
                    <selector>/drink/type</selector>
                    <condition>str_equals</condition>
                    <value>cold</value>
                </case>
            </config>
            <outputs>
                <output>ReplicadorFrio</output>
                <output>ReplicadorCaliente</output>
            </outputs>
        </task>
        <task>
            <name>ReplicadorFrio</name>
            <type>replicator</type>
            <outputs>
                <output>TraductorQueryFrio</output>
                <output>JuntadorFrio</output>
            </outputs>
        </task>
        <task>
            <name>TraductorQueryFrio</name>
            <type>translator</type>
            <config>
                <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
                    <xsl:template match="/drink">
                        <sql>SELECT `Stock` FROM `bebidas` WHERE `Nombre` = '<xsl:value-of select="name"/>'</sql>
                    </xsl:template>
                </xsl:stylesheet>
            </config>
            <outputs>
                <output>BarmanFrio</output>
            </outputs>
        </task>
        <task>
            <name>TraductorResultadoFrio</name>
            <type>translator</type>
            <config>
                <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
                    <xsl:template match="/Results">
                        <drink>
                            <stock>
                                <xsl:value-of select="Row/Stock"/>
                            </stock>
                        </drink>
                    </xsl:template>
                </xsl:stylesheet>
            </config>
            <outputs>
                <output>JuntadorFrio</output>
            </outputs>
        </task>
        <task>
            <name>JuntadorFrio</name>
            <type>correlator</type>
            <outputs>
                <output>CombinadorFrio</output>
                <output>CombinadorFrio</output>
            </outputs>
        </task>
        <task>
            <name>CombinadorFrio</name>
            <type>context_enricher</type>
            <outputs>
                <output>Reunidor</output>
            </outputs>
        </task>
        <task>
            <name>ReplicadorCaliente</name>
            <type>replicator</type>
            <outputs>
                <output>TraductorQueryCaliente</output>
                <output>JuntadorCaliente</output>
            </outputs>
        </task>
        <task>
            <name>TraductorQueryCaliente</name>
            <type>translator</type>
            <config>
                <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
                    <xsl:template match="/drink">
                        <call>
                            <action>consultarStock</action>
                            <nombre>
                                <xsl:value-of select="name"/>
                            </nombre>
                        </call>
                    </xsl:template>
                </xsl:stylesheet>
            </config>
            <outputs>
                <output>BarmanCaliente</output>
            </outputs>
        </task>
        <task>
            <name>TraductorResultadoCaliente</name>
            <type>translator</type>
            <config>
                <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
                    <xsl:template match="/response">
                        <drink>
                            <stock>
                                <xsl:value-of select="msg"/>
                            </stock>
                        </drink>
                    </xsl:template>
                </xsl:stylesheet>
            </config>
            <outputs>
                <output>JuntadorCaliente</output>
            </outputs>
        </task>
        <task>
            <name>JuntadorCaliente</name>
            <type>correlator</type>
            <outputs>
                <output>CombinadorCaliente</output>
                <output>CombinadorCaliente</output>
            </outputs>
        </task>
        <task>
            <name>CombinadorCaliente</name>
            <type>context_enricher</type>
            <outputs>
                <output>Reunidor</output>
            </outputs>
        </task>
        <task>
            <name>Reunidor</name>
            <type>merger</type>
            <outputs>
                <output>Arrejuntador</output>
            </outputs>
        </task>
        <task>
            <name>Arrejuntador</name>
            <type>aggregator</type>
            <config>
                <root>cafe_order</root>
                <root>drinks</root>
            </config>
            <outputs>
                <output>Camarero</output>
            </outputs>
        </task>
    </tasks>
    <adapters>
        <adapter>
            <name>Comandas</name>
            <type>dir_watcher</type>
            <config>C:\PROYECTOS\UNI\IIA\Simulaciones\cafe\comandas</config>
            <outputs>
                <output>Divisor</output>
            </outputs>
        </adapter>
        <adapter>
            <name>Camarero</name>
            <type>dir_outputter</type>
            <config>C:\PROYECTOS\UNI\IIA\Simulaciones\cafe\camarero</config>
            <outputs>
            </outputs>
        </adapter>
        <adapter>
            <name>BarmanFrio</name>
            <type>mysql</type>
            <config>
                <host>localhost</host>
                <port>3306</port>
                <db>cafe</db>
                <user>root</user>
                <pass></pass>
            </config>
            <outputs>
                <output>TraductorResultadoFrio</output>
            </outputs>
        </adapter>
        <adapter>
            <name>BarmanCaliente</name>
            <type>web_api</type>
            <config>http://localhost/cafe/api.php</config>
            <outputs>
                <output>TraductorResultadoCaliente</output>
            </outputs>
        </adapter>
    </adapters>
</process>